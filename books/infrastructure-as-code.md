# Infrastructure as Code

번역서:

- [리디북스](https://ridibooks.com/v2/Detail?id=443000488)
- [yes24](http://www.yes24.com/24/Goods/36551650?Acode=101)

## 구성 편차

클라우드와 가상화를 이용하면 관리할 수 있는 능력보다 더 빠른 속도로 서버가 증식할 수 있다.

이런 경우에 서버마다 패치나 최신 업데이트를 부분적으로 수행하게 되면, 서버마다 버전이나 구성이 달라지게 된다.

이로 인해 서버간의 불일치가 일어나게 되는데, 이를 `구성 편차(configuration drift)`라고 한다.

## 눈송이 서버

서버마다 구성이 다르다고 해서 나쁜 것은 아니다. 상황에 맞게 다른 서버마다 다른 설정을 적용할 수도 있다.
단, 이런 변종 서버를 파악하고 쉽게 재생성할 수 있게 관리해야 한다.

관리되지 않는 변종 서버는 결국 `눈송이(snowflake)`서버와 자동화 공포를 일으킨다.

눈송이 서버는 네트워크상의 다른 서버들과는 다르게 구성된 서버를 말한다. 눈송이 서버는 다시 만들 수 없다는 점에서 특별하다.

팀은 인프라 안의 어떤 서버든 확신을 갖고 쉽고 빠르게 다시 만들 수 있어야 한다.

쉽게 만든다는 것은 무언가를 다시 만드는 방법에 대해 어떠한 중요한 결정도 할 필요가 없다는 의미다.

## 원칙

1. 시스템은 쉽게 다시 만들 수 있다
1. 시스템은 일회용이다
    - 인프라는 동적이고 언제나 삭제, 교체, 이동 된다는 점을 상기해야 한다
    - 서버에 수동으로 넣은 설정이나 파일은 언제든지 없어질 수 있다
1. 시스템은 일관성이 있다
    - 같은 서비스를 제공하는 시스템의 사양은 최대한 비슷해야 한다
    - 일부 서버가 다른 사양을 가지게 된다면 동일하게 맞추거나, 다른 사양이 존재할 수 있도록 새로운 등급을 추가해야 한다
1. 절차는 반복 가능하다
    - 인프라에서 실행한 어떤 작업이든 다시 실행할 수 있어야 한다
1. 설계는 항상 변한다
    - 동적 인프라는 구성 변경이 쉽고 비용은 낮다
    - 다양한 요구사항을 기대하지 않고, 현재의 요구사항만 충족하는 단순한 설계를 해야 한다.
    - 구성을 자주 변경해 봄으로써 시스템을 안전하고 빠르게 변경할 수 있다

## 관례

1. 정의 파일을 사용하라
1. 자체 문서화
    - 문서는 쉽게 낡으니, 쉽게 찾아볼 수 있도록 설명할 코드 근처에 한다
    - 혹은 자동으로 문서가 생성될 수 있도록 한다
1. 모든 것의 버전을 관리
1. 시스템과 절차를 계속 시험하라
1. 일괄 변경보다는 조금씩 변경하라

## 효과적인 팀의 특성

- 인프라의 모든 요소를 적은 노력으로 빠르게 다시 만들 수 있다
- 모든 시스템을 지속해서 패치하고, 일관성을 유지하며, 최신 상태로 관리한다
- 서버와 환경을 프로비저닝하는 등의 인프라 서비스는 인프라 팀의 도움 없이 수 분 안으로 처리할 수 있다
- 유지 보수 시간은 거의 필요 없다
- 평균 복구 시간(Mean Time To Recover, MTTR)을 관리하고 개선하는 데 관심을 가진다. 평균 무고장 시간(Mean Time Between Failures, MTBF)을 관리하기는 하지만, 고장을 피할 수 있다고 생각하지는 않는다 [^1]
- 그들의 작업이 조직에 매우 중요한 가치를 부여한다고 생각한다

[^1]: http://www.kitchensoap.com/2010/11/07/mttr-mtbf-for-most-types-of-f/